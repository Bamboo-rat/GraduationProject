spring.application.name=backend
# ===============================
# = SERVER CONFIGURATION
# ===============================
server.port=${PORT:8080}

# ===============================
# Spring Boot features - Optimized for Standard plan (2GB RAM)
spring.jmx.enabled=false
spring.main.banner-mode=off
spring.output.ansi.enabled=NEVER
spring.main.lazy-initialization=false

# Actuator endpoints - Basic monitoring for fast startup
management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true
management.endpoint.health.show-details=when-authorized
management.endpoints.web.exposure.include=health,info,metrics
management.health.defaults.enabled=false
management.health.db.enabled=false
management.health.redis.enabled=false

# Optimized thread pools for Standard plan (2GB RAM)
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.max-connections=10000
server.tomcat.accept-count=100

# Enhanced task execution pool
spring.task.execution.pool.core-size=4
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.scheduling.pool.size=4


# ===============================
# = DATASOURCE (AWS RDS) - Commented out for local development
# ===============================
spring.datasource.url=${DB_URL:jdbc:mysql://foodsave.cbqgwoyam2lh.ap-southeast-2.rds.amazonaws.com:3306/foodsave?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&zeroDateTimeBehavior=convertToNull}
spring.datasource.username=admin
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:E0MvlgcXl1UD2nBpf5A9}
# Ensure zero date values (e.g. 0000-00-00) are converted to null instead of causing JDBC exceptions
spring.datasource.hikari.data-source-properties.zeroDateTimeBehavior=convertToNull

# HikariCP Configuration - Optimized for Standard plan (2GB RAM)
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.leak-detection-threshold=60000

spring.jpa.hibernate.ddl-auto=validate
# Disable SQL logging for faster startup
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
# Fast startup optimizations
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.datasource.tomcat.initSQL=SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci

# Transaction Isolation Level
# 1 = READ_UNCOMMITTED, 2 = READ_COMMITTED, 4 = REPEATABLE_READ, 8 = SERIALIZABLE
# Using REPEATABLE_READ to prevent phantom reads and non-repeatable reads
spring.jpa.properties.hibernate.connection.isolation=4

# Optimistic Locking Configuration
# Throw exception when version mismatch detected
spring.jpa.properties.javax.persistence.lock.timeout=5000

# ===============================
# KEYCLOAK CONFIGURATION
# ===============================
keycloak.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL}
keycloak.realm=${KEYCLOAK_REALM}
keycloak.resource=${KEYCLOAK_RESOURCE}
keycloak.customer.client-secret=${KEYCLOAK_CLIENT_SECRET}

keycloak.admin.username=${KEYCLOAK_ADMIN_USERNAME}
keycloak.admin.password=${KEYCLOAK_ADMIN_PASSWORD}
keycloak.admin.client-id=${KEYCLOAK_ADMIN_CLIENT_ID}

spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_AUTH_SERVER_URL}/realms/${KEYCLOAK_REALM}


# ===============================
# SENDGRID CONFIGURATION
# ===============================
sendgrid.api-key=${SENDGRID_API_KEY}
sendgrid.from-email=${SENDGRID_FROM_EMAIL}
sendgrid.from-name=${SENDGRID_FROM_NAME}

# ===============================
# APPLICATION CONFIGURATION
# ===============================
app.frontend-url=${FRONTEND_URL}
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS}

# ===============================
# CLOUDINARY CONFIGURATION
# ===============================
cloudinary.cloud-name=${CLOUDINARY_CLOUD_NAME}
cloudinary.api-key=${CLOUDINARY_API_KEY}
cloudinary.api-secret=${CLOUDINARY_API_SECRET}

# Folder names for organizing files
cloudinary.folder.business-licenses=business-licenses
cloudinary.folder.food-safety-certificates=food-safety-certificates
cloudinary.folder.banner=banner
cloudinary.folder.products=products
cloudinary.folder.avatar-customer=avatar-customer
cloudinary.folder.avatar-admin=avatar-admin
cloudinary.folder.supplier-logo=supplier-logo


# ===============================
# REDIS CONFIGURATION - Optimized for Standard plan
# ===============================
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.ssl.enabled=${REDIS_SSL:true}
spring.data.redis.timeout=10000
spring.data.redis.connect-timeout=10000
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=16
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=2
spring.data.redis.lettuce.pool.max-wait=2000ms

# ===============================
# CUSTOM JWT CONFIGURATION (for Customer authentication)
# ===============================
# Secret key for signing customer JWTs (must be at least 32 characters)
jwt.secret=${JWT_SECRET:12507b0ad6ed822538d789fba5dd4129ed344a636eab0d97c1d70586c9e242c9}
# Access token expiration in milliseconds (20 hours = 72000000)
jwt.access-token-expiration=72000000
# Refresh token expiration in milliseconds (7 days = 604800000)
jwt.refresh-token-expiration=604800000


# ===============================
# PAYOS
# ===============================
payos.client-id=af093696-9d94-4744-8976-cb27487086b6
payos.api-key=2ed881cf-6ec8-4576-ab94-6fdd72e41bbb
payos.checksum-key=63079253be4ad6ee6bc34267a70e1b6614017f0cd42831c61e0e59999337bd0c
payos.base-url=https://api-merchant.payos.vn
payos.return-url=https://your-domain.com/mobile/payos/return
payos.cancel-url=https://your-domain.com/mobile/payos/cancel


